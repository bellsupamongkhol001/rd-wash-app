"use strict";(self.webpackChunkrd_wash_001=self.webpackChunkrd_wash_001||[]).push([[394],{294:(e,t,n)=>{n.r(t),n.d(t,{checkAndUpdateWashStatus:()=>Pe,confirmDeleteWash:()=>ge,handleESDRequest:()=>Ie,handleESDTestFail:()=>Oe,initWashPage:()=>ue,markAsESDFail:()=>Be,markAsESDPass:()=>De,openAddWashModal:()=>me,openEditWashModal:()=>ve,setupEventListeners:()=>pe,setupSearchAndFilter:()=>de,shiftWashDate:()=>Ne});var r=n(458),a=n(296),o=n(980),c=n(467),s=n(756),i=n.n(s),u=n(482),l=n(594),d=n(284);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h="WashJobs",m="WashHistory",v="InventoryDB";function w(){return y.apply(this,arguments)}function y(){return(y=(0,c.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,l.GG)((0,l.rJ)(u.db,h));case 3:return t=e.sent,e.abrupt("return",t.docs.map((function(e){return f({id:e.id},e.data())})));case 7:return e.prev=7,e.t0=e.catch(0),console.error("❌ [getAllWashes] ไม่สามารถดึงข้อมูลได้:",e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function x(e){return g.apply(this,arguments)}function g(){return(g=(0,c.A)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=(0,l.H9)(u.db,h,t),e.next=4,(0,l.x7)(n);case 4:return r=e.sent,e.abrupt("return",r.exists()?f({id:r.id},r.data()):null);case 8:return e.prev=8,e.t0=e.catch(0),console.error("❌ [getWashJobById] ไม่พบ ID: ".concat(t),e.t0),e.abrupt("return",null);case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function b(e){return S.apply(this,arguments)}function S(){return S=(0,c.A)(i().mark((function e(t){var n,r,a,o,c=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:null,e.prev=1,"string"!=typeof(r=n||(null==t?void 0:t.washId))||""===r.trim()){e.next=8;break}return a=(0,l.H9)(u.db,h,r),e.next=7,(0,l.BN)(a,t);case 7:return e.abrupt("return",r);case 8:return e.next=10,(0,l.gS)((0,l.rJ)(u.db,h),t);case 10:return o=e.sent,e.abrupt("return",o.id);case 14:throw e.prev=14,e.t0=e.catch(1),console.error("❌ [addWashJob] ไม่สามารถเพิ่มหรืออัปเดตได้:",e.t0),e.t0;case 18:case"end":return e.stop()}}),e,null,[[1,14]])}))),S.apply(this,arguments)}function E(e,t){return k.apply(this,arguments)}function k(){return(k=(0,c.A)(i().mark((function e(t,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,l.mZ)((0,l.H9)(u.db,h,t),n);case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),console.error("❌ [updateWashJob] อัปเดตไม่สำเร็จ: ".concat(t),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function I(e){return C.apply(this,arguments)}function C(){return(C=(0,c.A)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,l.kd)((0,l.H9)(u.db,h,t));case 3:e.next=9;break;case 5:throw e.prev=5,e.t0=e.catch(0),console.error("❌ [deleteWashJob] ลบไม่สำเร็จ: ".concat(t),e.t0),e.t0;case 9:case"end":return e.stop()}}),e,null,[[0,5]])})))).apply(this,arguments)}function D(){return A.apply(this,arguments)}function A(){return(A=(0,c.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,l.GG)((0,l.rJ)(u.db,m));case 3:return t=e.sent,e.abrupt("return",t.docs.map((function(e){return f({id:e.id},e.data())})));case 7:return e.prev=7,e.t0=e.catch(0),console.error("❌ [getAllWashHistory] ไม่สามารถดึงข้อมูลได้:",e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function B(e){return W.apply(this,arguments)}function W(){return W=(0,c.A)(i().mark((function e(t){var n,r,a,o,c=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=c.length>1&&void 0!==c[1]?c[1]:null,e.prev=1,t&&"object"===(0,d.A)(t)){e.next=4;break}throw new Error("ข้อมูลที่ส่งมาไม่ถูกต้อง");case 4:if(r=(0,l.rJ)(u.db,m),!n){e.next=12;break}return a=(0,l.H9)(r,n),e.next=9,(0,l.BN)(a,f(f({},t),{},{createdAt:t.createdAt||(new Date).toISOString()}));case 9:return e.abrupt("return",n);case 12:return e.next=14,(0,l.gS)(r,f(f({},t),{},{createdAt:t.createdAt||(new Date).toISOString()}));case 14:return o=e.sent,e.abrupt("return",o.id);case 16:e.next=22;break;case 18:throw e.prev=18,e.t0=e.catch(1),console.error("❌ [addToWashHistory] เพิ่มประวัติการซักไม่สำเร็จ:",e.t0),e.t0;case 22:case"end":return e.stop()}}),e,null,[[1,18]])}))),W.apply(this,arguments)}function O(e){return L.apply(this,arguments)}function L(){return L=(0,c.A)(i().mark((function e(t){var n,r,a,o=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:null,e.prev=1,e.next=4,(0,l.GG)((0,l.rJ)(u.db,v));case 4:return r=e.sent,a=(a=r.docs.map((function(e){return f(f({},e.data()),{},{id:e.id})}))).filter((function(e){return String(e.UniformCode||"").toLowerCase().includes(t.toLowerCase())})),n&&(a=a.filter((function(e){return e.UniformColor===n}))),e.abrupt("return",a);case 11:return e.prev=11,e.t0=e.catch(1),console.error("❌ [getUniformByCode] Failed:",e.t0),e.abrupt("return",[]);case 15:case"end":return e.stop()}}),e,null,[[1,11]])}))),L.apply(this,arguments)}function P(e,t){return j.apply(this,arguments)}function j(){return(j=(0,c.A)(i().mark((function e(t,n){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,n);case 2:return r=e.sent,e.abrupt("return",r.length>0&&r[0].RewashCount||0);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,t,n){return F.apply(this,arguments)}function F(){return(F=(0,c.A)(i().mark((function e(t,n,r){var a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,n);case 2:if(0!==(a=e.sent).length){e.next=5;break}return e.abrupt("return");case 5:return o=a[0].id,e.next=8,(0,l.mZ)((0,l.H9)(u.db,v,o),{RewashCount:r});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return H.apply(this,arguments)}function H(){return(H=(0,c.A)(i().mark((function e(t,n){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O(t,n);case 2:if(0!==(r=e.sent).length){e.next=5;break}return e.abrupt("return");case 5:return a=r[0].id,e.next=8,(0,l.mZ)((0,l.H9)(u.db,v,a),{Status:"scrap",usageStatus:"scrap","status.assign":(0,l.CL)(),"status.washing":(0,l.CL)()});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return R.apply(this,arguments)}function R(){return(R=(0,c.A)(i().mark((function e(t){var n,r,a,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,O(t.uniformCode,t.color);case 3:if(0!==(n=e.sent).length){e.next=7;break}return console.warn("⚠️ [returnToStockAfterESD] ไม่พบ Uniform ที่ต้องการอัปเดต"),e.abrupt("return");case 7:return r=n[0].id,a=n[0],o=a.Status||"available","ESD Failed"===t.status?(c=(t.rewashCount||0)+1,o="Rewash #".concat(c)):"ESD Passed"===t.status&&(o="available"),e.next=13,(0,l.mZ)((0,l.H9)(u.db,v,r),{Status:o,usageStatus:"available"===o?"available":"in-use"});case 13:e.next=19;break;case 15:throw e.prev=15,e.t0=e.catch(0),console.error("❌ [returnToStockAfterESD] error:",e.t0),e.t0;case 19:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function U(e){return e?new Date(e).toLocaleDateString("th-TH",{day:"2-digit",month:"2-digit",year:"numeric"}):"-"}function J(){return z.apply(this,arguments)}function z(){return z=(0,c.A)(i().mark((function e(){var t,n,r,a,o,c,s,d,p,f,h,m,v=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=v.length>0&&void 0!==v[0]?v[0]:"WASHID",n=new Date,r=n.getFullYear().toString().slice(),a=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0"),c="".concat(o).concat(a).concat(r),s=(0,l.H9)(u.db,"WashCounters","".concat(t,"-").concat(c)),d=1,e.next=10,(0,l.x7)(s);case 10:if((p=e.sent).exists()&&(f=p.data(),d=((null==f?void 0:f.last)||0)+1),!(d>999)){e.next=14;break}throw new Error("⚠️ WashID เกินจำนวนที่อนุญาตต่อวัน (999)");case 14:return h=d.toString().padStart(3,"0"),m="".concat(t,"-").concat(c,"-").concat(h),e.next=18,(0,l.BN)(s,{last:d});case 18:return e.abrupt("return",m);case 19:case"end":return e.stop()}}),e)}))),z.apply(this,arguments)}function G(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"⏳ Processing...",t=document.getElementById("loadingOverlay");if(t){t.style.display="flex";var n=t.querySelector("p");n&&(n.textContent=e)}else console.warn("⚠️ loadingOverlay ไม่พบใน DOM")}function q(){var e=document.getElementById("loadingOverlay");e?e.style.display="none":console.warn("⚠️ loadingOverlay ไม่พบใน DOM")}function V(){return Y.apply(this,arguments)}function Y(){return Y=(0,c.A)(i().mark((function e(){var t,n,r,a,o,s,u,l,d,p,f,h=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=h.length>0&&void 0!==h[0]?h[0]:[],a=h.length>1&&void 0!==h[1]?h[1]:1,o=h.length>2&&void 0!==h[2]?h[2]:10,s=(null===(t=document.getElementById("searchInput"))||void 0===t?void 0:t.value.toLowerCase())||"",u=(null===(n=document.getElementById("filterStatus"))||void 0===n?void 0:n.value)||"",l=r.filter((function(e){var t=[e.uniformCode,e.empId,e.empName].filter(Boolean).some((function(e){return e.toLowerCase().includes(s)})),n=!u||e.status===u;return t&&n})),d=(a-1)*o,p=l.slice(d,d+o),(f=document.getElementById("washTableBody")).innerHTML="",0!==p.length){e.next=13;break}return f.innerHTML='<tr><td colspan="6" style="text-align:center;">🚫 No data found</td></tr>',e.abrupt("return");case 13:return e.next=15,Promise.all(p.map(Pe));case 15:e.sent.forEach((function(e){var t="Completed"===e.status,n=document.createElement("tr");n.innerHTML="\n      <td>".concat(e.washId||"-","</td>\n      <td>").concat(e.empName||"-","<br><small>").concat(e.empId||"","</small></td>\n      <td>").concat(e.uniformCode||"-","</td>\n      <td>").concat(e.color||"-",'</td>\n      <td><span class="status ').concat(Z(e),'">').concat(_(e),'</span></td>\n      <td class="actions">\n        ').concat(t?'\n          <button class="btn-esd" data-id="'.concat(e.id,'">\n            <i class="fas fa-bolt"></i>\n          </button>'):"",'\n        <button class="btn-delete" data-id="').concat(e.id,'">\n          <i class="fas fa-trash-alt"></i>\n        </button>\n        <button class="shift-date" data-id="').concat(e.washId,'">\n          <i class="fas fa-clock"></i>\n        </button>\n      </td>\n    '),f.appendChild(n)})),f.querySelectorAll(".btn-delete").forEach((function(e){e.addEventListener("click",(function(e){ge(e.target.dataset.id)}))})),f.querySelectorAll(".shift-date").forEach((function(e){e.addEventListener("click",function(){var e=(0,c.A)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.target.dataset.id,r=parseInt(prompt("📅 Shift กี่วัน? เช่น 1 หรือ -2")),isNaN(r)){e.next=5;break}return e.next=5,Ne(n,r);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})),f.querySelectorAll(".btn-esd").forEach((function(e){e.addEventListener("click",(function(e){Ie(e.target.dataset.id)}))})),Q(l.length,a,o,(function(e){V(r,e,o)}));case 21:case"end":return e.stop()}}),e)}))),Y.apply(this,arguments)}function Z(e){var t=e.rewashCount||0,n=e.status;return"Waiting to Send"===n?0===t?"status-waiting":"status-waiting-rewash":"Washing"===n?0===t?"status-washing":"status-rewashing":"Completed"===n?"status-completed":"ESD Passed"===n?"status-passed":"ESD Failed"===n?"status-failed":"Scrap"===n?"status-scrap":""}function _(e){var t=e.rewashCount||0,n=e.status;return"Waiting to Send"===n?0===t?"Waiting to Send":"Waiting-Rewash #".concat(t):"Washing"===n?0===t?"Washing":"Re-Washing #".concat(t):"Completed"===n?"Completed":"ESD Passed"===n?"ESD Passed":"ESD Failed"===n?"ESD Failed (".concat(t," times)"):"Scrap"===n?"Scrap (Over limit)":n||"-"}function Q(e,t,n,r){var a=document.getElementById("pagination");if(a){var o=Math.ceil(e/n);if(a.innerHTML="",t>1){var c=X("«",t-1,r);a.appendChild(c)}for(var s=1;s<=o;s++){var i=X(s,s,r,t===s);a.appendChild(i)}if(t<o){var u=X("»",t+1,r);a.appendChild(u)}}}function X(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=document.createElement("button");return a.textContent=e,r&&a.classList.add("active"),a.addEventListener("click",(function(){n(t)})),a}function K(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=document.getElementById("historyTableBody"),o=document.getElementById("historyPagination");if(a&&o){a.innerHTML="",o.innerHTML="";var c=(0,r.A)(e).sort((function(e,t){var n=e.washId||"",r=t.washId||"";return n.localeCompare(r)})),s=(t-1)*n,i=c.slice(s,s+n);if(0!==i.length){i.forEach((function(e){var t=document.createElement("tr");t.innerHTML="\n      <td>".concat(e.washId||"-","</td>\n      <td>").concat(e.uniformCode||"-","</td>\n      <td>").concat(e.empName||"-","<br><small>").concat(e.empId||"","</small></td>\n      <td>").concat(e.testResult||"-","</td>\n      <td>\n        <div>\n          <strong>Created:</strong> ").concat(e.createdAt?U(e.createdAt):"-","<br>\n          <strong>Tested:</strong> ").concat(e.testDate?U(e.testDate):"<span style='color:gray;'>Not tested yet</span>",'\n        </div>\n      </td>\n      <td><span class="status ').concat(Z(e),'">').concat(_(e),"</span></td>\n    "),a.appendChild(t)}));for(var u=Math.ceil(c.length/n),l=function(r){var a=document.createElement("button");a.textContent=r,a.className=r===t?"active":"",a.addEventListener("click",(function(){return K(e,r,n)})),o.appendChild(a)},d=1;d<=u;d++)l(d)}else a.innerHTML='<tr><td colspan="6" style="text-align:center;">🚫 No history found</td></tr>'}}function $(){return ee.apply(this,arguments)}function ee(){return(ee=(0,c.A)(i().mark((function e(){var t,n,r,a,o,c,s,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,te();case 2:t=e.sent,n=t.total,r=t.waiting,a=t.washing,o=t.completed,c=t.rewash,s=t.scrap,u=t.history,re("sumTotal",n),re("sumWaiting",r),re("sumWashing",a),re("sumCompleted",o),re("sumRewash",c),re("sumScrap",s),re("sumHistory",u);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(){return ne.apply(this,arguments)}function ne(){return(ne=(0,c.A)(i().mark((function e(){var t,n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return t=e.sent,e.next=5,D();case 5:return n=e.sent,r=function(e){return t.filter((function(t){return e(t.status)})).length},e.abrupt("return",{total:t.length,waiting:r((function(e){return"Waiting to Send"===e})),washing:r((function(e){return"Washing"===e})),completed:r((function(e){return"Completed"===e})),rewash:r((function(e){return(e||"").includes("Rewash")})),scrap:r((function(e){return"Scrap"===e})),history:n.length});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function re(e,t){var n=document.getElementById(e);n?n.textContent=null!=t?t:"-":console.warn('⚠️ setText: ไม่พบ element ที่มี id = "'.concat(e,'"'))}function ae(e){var t=document.getElementById("esdModal");if(t){re("esdUniformCode",e.uniformCode),re("esdEmpId",e.empId),re("esdEmpName",e.empName);var n=document.getElementById("btnPassESD");n&&(n.onclick=function(){De(e).catch(console.error),t.style.display="none"});var r=document.getElementById("btnFailESD");r&&(r.onclick=function(){Oe(e).catch(console.error),t.style.display="none"}),t.addEventListener("click",(function(e){e.target===t&&(t.style.display="none")})),window.addEventListener("keydown",(function(e){"Escape"===e.key&&(t.style.display="none")}),{once:!0}),t.style.display="flex"}}var oe=n(453);function ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function se(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(n),!0).forEach((function(t){(0,o.A)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ie=1;function ue(){return le.apply(this,arguments)}function le(){return le=(0,c.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:try{G("🔄 Loading Wash Page..."),pe(),t=(0,l.rJ)(u.db,"WashJobs"),(0,l.aQ)(t,function(){var e=(0,c.A)(i().mark((function e(t){var n,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.docs.map((function(e){return se({id:e.id},e.data())})),e.next=3,Promise.all(n.map(Pe));case 3:return V(r=e.sent),$(r),e.next=8,D();case 8:K(e.sent);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),de()}catch(e){console.error("❌ Error loading Wash page:",e),Swal.fire({icon:"error",title:"Error",text:"❌ Unable to load data. Please try again."})}finally{q()}case 1:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}function de(){var e=document.getElementById("searchInput"),t=document.getElementById("filterStatus");e&&e.addEventListener("input",(0,c.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return t=e.sent,e.next=5,Promise.all(t.map(Pe));case 5:V(e.sent,ie);case 7:case"end":return e.stop()}}),e)})))),t&&t.addEventListener("change",(0,c.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return t=e.sent,e.next=5,Promise.all(t.map(Pe));case 5:V(e.sent,ie);case 7:case"end":return e.stop()}}),e)}))))}function pe(){var e,t,n,r,a,o,s,u,l;null===(e=(0,oe.y)("searchInput"))||void 0===e||e.addEventListener("input",(0,oe.s)((0,c.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return t=e.sent,e.next=5,Promise.all(t.map(Pe));case 5:V(e.sent,ie);case 7:case"end":return e.stop()}}),e)}))),300)),null===(t=(0,oe.y)("filterStatus"))||void 0===t||t.addEventListener("change",(0,c.A)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w();case 2:return t=e.sent,e.next=5,Promise.all(t.map(Pe));case 5:V(e.sent,ie);case 7:case"end":return e.stop()}}),e)})))),null===(n=(0,oe.y)("btnSaveWash"))||void 0===n||n.addEventListener("click",ye),null===(r=(0,oe.y)("btnAddWash"))||void 0===r||r.addEventListener("click",me),null===(a=(0,oe.y)("uniformCode"))||void 0===a||a.addEventListener("input",(0,oe.s)(be,300)),null===(o=(0,oe.y)("color"))||void 0===o||o.addEventListener("change",Ee),null===(s=(0,oe.y)("btnCloseModal"))||void 0===s||s.addEventListener("click",(function(){return fe(!1)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&fe(!1)})),null===(u=(0,oe.y)("btnExportWashHistoryCSV"))||void 0===u||u.addEventListener("click",Me),null===(l=(0,oe.y)("btnExportCSV"))||void 0===l||l.addEventListener("click",Te),document.addEventListener("click",(function(e){e.target.classList.contains("btn-esd-fail")&&Oe(e.target.dataset.id)}))}function fe(e){var t=document.getElementById("washModal");t&&(t.style.display=e?"flex":"none",e||he())}function he(){["empId","empName","uniformCode","editIndex","size"].forEach((function(e){var t=document.getElementById(e);t&&(t.value="")}));var e=document.getElementById("color");e&&(e.innerHTML='<option value="">Select Color</option>',e.disabled=!0)}function me(){var e=document.getElementById("washModal"),t=document.getElementById("modalTitle");e&&t&&(he(),t.textContent="Add Wash Job",e.style.display="flex")}function ve(e){return we.apply(this,arguments)}function we(){return(we=(0,c.A)(i().mark((function e(t){var n,r,o,c,s,u,l,d,p;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x(t);case 2:if(n=e.sent){e.next=6;break}return alert("❌ Data not found"),e.abrupt("return");case 6:for(r={editIndex:t,uniformCode:n.uniformCode,color:n.color,empId:n.empId,empName:n.empName},o=0,c=Object.entries(r);o<c.length;o++)s=(0,a.A)(c[o],2),u=s[0],l=s[1],(d=document.getElementById(u))&&(d.value=l||"");(p=document.getElementById("modalTitle"))&&(p.textContent="Edit Wash Job"),fe(!0);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(){return xe.apply(this,arguments)}function xe(){return(xe=(0,c.A)(i().mark((function e(){var t,n,r,a,o,c,s,u,l,d,p,f,h,m,v,y,x,g,S,E;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((c=document.getElementById("btnSaveWash"))&&(c.disabled=!0),s=null===(t=document.getElementById("uniformCode"))||void 0===t?void 0:t.value.trim(),u=null===(n=document.getElementById("color"))||void 0===n?void 0:n.value,l=null===(r=document.getElementById("empId"))||void 0===r?void 0:r.value.trim(),d=null===(a=document.getElementById("empName"))||void 0===a?void 0:a.value.trim(),p=(null===(o=document.getElementById("size"))||void 0===o?void 0:o.value.trim())||"",f=l||"-",h=d||"-",s&&u){e.next=13;break}return Swal.fire({icon:"warning",title:"Incomplete Data",text:"Please fill in all required fields."}),c&&(c.disabled=!1),e.abrupt("return");case 13:return e.prev=13,G("🔄 Checking..."),e.next=17,w();case 17:if(!e.sent.find((function(e){return e.uniformCode===s&&e.color===u&&!["ESD Passed","Scrap"].includes(e.status)}))){e.next=22;break}return Swal.fire({icon:"error",title:"Cannot Add",text:"This uniform is already being processed."}),e.abrupt("return");case 22:return e.next=24,J();case 24:return m=e.sent,e.next=27,P(s,u);case 27:if(!((v=e.sent)>3)){e.next=42;break}return y={washId:m,empId:f,empName:h,uniformCode:s,color:u,size:p,rewashCount:v,status:"Scrap",testResult:"FAIL",createdAt:(new Date).toISOString(),testDate:(new Date).toISOString()},e.next=32,B(y);case 32:return e.next=34,T(s,u);case 34:return fe(!1),e.next=37,w();case 37:return V(x=e.sent),$(x),Swal.fire({icon:"warning",title:"Uniform Scrapped",text:"Exceeded 3 washes."}),e.abrupt("return");case 42:if(g=v>0?"Waiting-Rewash #".concat(v):"Waiting to Send",S={washId:m,empId:f,empName:h,uniformCode:s,color:u,size:p,status:g,rewashCount:v,createdAt:(new Date).toISOString()},!(v>0)){e.next=47;break}return e.next=47,N(s,u,v);case 47:return e.next=49,b(S,m);case 49:return fe(!1),e.next=52,w();case 52:V(E=e.sent),$(E),Swal.fire({icon:"success",title:"Saved Successfully"}),e.next=62;break;case 58:e.prev=58,e.t0=e.catch(13),console.error("❌ saveWashJob error:",e.t0),Swal.fire({icon:"error",title:"Error",text:"Please try again."});case 62:return e.prev=62,q(),c&&(c.disabled=!1),e.finish(62);case 66:case"end":return e.stop()}}),e,null,[[13,58,62,66]])})))).apply(this,arguments)}function ge(e){!function(e,t){var n=document.getElementById("confirmModal");if(n){n.style.display="flex";var r=document.getElementById("btnConfirmYes"),a=document.getElementById("btnConfirmNo");if(r&&a){var o=function(){n.style.display="none",r.onclick=null,a.onclick=null};r.onclick=(0,c.A)(i().mark((function n(){return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o(),n.next=3,t(e);case 3:case"end":return n.stop()}}),n)}))),a.onclick=o,n.onclick=function(e){e.target===n&&o()}}}}(e,function(){var e=(0,c.A)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G("🗑️ Deleting wash job..."),e.next=4,I(t);case 4:return e.next=6,Swal.fire({icon:"success",title:"Deleted Successfully",timer:1500,showConfirmButton:!1});case 6:e.next=13;break;case 8:return e.prev=8,e.t0=e.catch(0),console.error("❌ Failed to delete wash job:",e.t0),e.next=13,Swal.fire({icon:"error",title:"Error",text:"Failed to delete wash job. Please try again."});case 13:return e.prev=13,q(),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[0,8,13,16]])})));return function(t){return e.apply(this,arguments)}}())}function be(){return Se.apply(this,arguments)}function Se(){return(Se=(0,c.A)(i().mark((function e(){var t,n,a,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=null===(t=document.getElementById("uniformCode"))||void 0===t?void 0:t.value.trim(),a=document.getElementById("size"),o=document.getElementById("color"),n){e.next=5;break}return e.abrupt("return");case 5:return e.prev=5,e.next=8,O(n);case 8:if((c=e.sent)&&0!==c.length){e.next=15;break}return e.next=12,Swal.fire({icon:"error",title:"Uniform Not Found",text:"No uniform found with this code."});case 12:return a&&(a.value=""),o&&(o.innerHTML='<option value="">No Color Available</option>',o.disabled=!0),e.abrupt("return");case 15:a&&(a.value=c[0].UniformSize||""),o&&(o.innerHTML='<option value="">Select Color</option>',(0,r.A)(new Set(c.map((function(e){return e.UniformColor})))).forEach((function(e){var t=document.createElement("option");t.value=e,t.textContent=e,o.appendChild(t)})),o.disabled=!1),e.next=24;break;case 19:return e.prev=19,e.t0=e.catch(5),console.error("❌ autofillUniformInfo error:",e.t0),e.next=24,Swal.fire({icon:"error",title:"Error",text:"Failed to load uniform information. Please try again."});case 24:case"end":return e.stop()}}),e,null,[[5,19]])})))).apply(this,arguments)}function Ee(){return ke.apply(this,arguments)}function ke(){return(ke=(0,c.A)(i().mark((function e(){var t,n,r,a,o,c,s,u,l,d,p,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=document.getElementById("uniformCode"))||void 0===t?void 0:t.value.trim(),a=null===(n=document.getElementById("color"))||void 0===n?void 0:n.value,r&&a){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,O(r,a);case 7:(o=e.sent).length>0?(c=o[0],s=document.getElementById("empId"),u=document.getElementById("empName"),l=document.getElementById("size"),s&&(s.value=c.EmployeeID||"-"),u&&(u.value=c.EmployeeName||"-"),l&&(l.value=c.UniformSize||"")):(d=document.getElementById("empId"),p=document.getElementById("empName"),f=document.getElementById("size"),d&&(d.value="-"),p&&(p.value="-"),f&&(f.value="")),e.next=16;break;case 11:return e.prev=11,e.t0=e.catch(4),console.error("❌ autofillEmployeeInfo error:",e.t0),e.next=16,Swal.fire({icon:"error",title:"Error",text:"Failed to autofill employee information. Please try again."});case 16:case"end":return e.stop()}}),e,null,[[4,11]])})))).apply(this,arguments)}function Ie(e){return Ce.apply(this,arguments)}function Ce(){return(Ce=(0,c.A)(i().mark((function e(t){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G("🔍 Checking ESD..."),e.next=4,x(t);case 4:if((n=e.sent)&&"Completed"===n.status){e.next=9;break}return e.next=8,Swal.fire({icon:"warning",title:"Warning",text:"Data not found or status is not Completed."});case 8:return e.abrupt("return");case 9:ae(n),e.next=17;break;case 12:return e.prev=12,e.t0=e.catch(0),console.error("❌ handleESDRequest error:",e.t0),e.next=17,Swal.fire({icon:"error",title:"Error",text:"Failed to load ESD data. Please try again."});case 17:return e.prev=17,q(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[0,12,17,20]])})))).apply(this,arguments)}function De(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,c.A)(i().mark((function e(t){var n,r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,G("✅ Saving ESD Pass..."),r=se(se({},t),{},{testResult:"PASS",testDate:(new Date).toISOString(),status:"ESD Passed"}),!((null!==(n=t.rewashCount)&&void 0!==n?n:0)>0)){e.next=6;break}return e.next=6,N(t.uniformCode,t.color,0);case 6:return e.next=8,B(r);case 8:return e.next=10,M(r);case 10:return e.next=12,I(t.id||t.washId);case 12:return e.next=14,w();case 14:return V(a=e.sent),$(a),e.next=19,Swal.fire({icon:"success",title:"ESD Pass recorded successfully",timer:1500,showConfirmButton:!1});case 19:e.next=26;break;case 21:return e.prev=21,e.t0=e.catch(0),console.error("❌ markAsESDPass error:",e.t0),e.next=26,Swal.fire({icon:"error",title:"Error",text:"Failed to record ESD Pass."});case 26:return e.prev=26,q(),e.finish(26);case 29:case"end":return e.stop()}}),e,null,[[0,21,26,29]])})))).apply(this,arguments)}function Be(e){return We.apply(this,arguments)}function We(){return(We=(0,c.A)(i().mark((function e(t){var n,r,a,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G("⛔ Saving ESD Fail..."),r=null!==(n=t.rewashCount)&&void 0!==n?n:0,a=r+1,o=se(se({},t),{},{testResult:"FAIL",testDate:(new Date).toISOString(),status:"ESD Failed"}),e.next=7,B(o);case 7:if(!(a>3)){e.next=12;break}return e.next=10,T(t.uniformCode,t.color);case 10:e.next=14;break;case 12:return e.next=14,N(t.uniformCode,t.color,a);case 14:return e.next=16,I(t.id||t.washId);case 16:return e.next=18,w();case 18:return V(c=e.sent),$(c),e.next=23,Swal.fire({icon:"warning",title:"ESD Fail recorded",text:"Action completed successfully.",timer:2e3,showConfirmButton:!1});case 23:e.next=30;break;case 25:return e.prev=25,e.t0=e.catch(0),console.error("❌ markAsESDFail error:",e.t0),e.next=30,Swal.fire({icon:"error",title:"Error",text:"Failed to record ESD Fail."});case 30:return e.prev=30,q(),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[0,25,30,33]])})))).apply(this,arguments)}function Oe(e){return Le.apply(this,arguments)}function Le(){return(Le=(0,c.A)(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G("⛔ Processing ESD Fail..."),e.next=4,Be(t);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(0),console.error("❌ handleESDTestFail error:",e.t0),e.next=11,Swal.fire({icon:"error",title:"Error",text:"Failed to process ESD Fail."});case 11:return e.prev=11,q(),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[0,6,11,14]])})))).apply(this,arguments)}function Pe(e){return je.apply(this,arguments)}function je(){return(je=(0,c.A)(i().mark((function e(t){var n,r,a,o,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.createdAt&&!["Scrap","ESD Passed"].includes(t.status)){e.next=2;break}return e.abrupt("return",t);case 2:if(n=new Date(t.createdAt),r=new Date,a=Math.floor((r-n)/864e5),o=t.rewashCount||0,(c=a>=3?"Completed":a>=1?0===o?"Washing":"Re-Washing #".concat(o):0===o?"Waiting to Send":"Waiting-Rewash #".concat(o))===t.status){e.next=12;break}return console.log("🔁 Status changed: ".concat(t.status," → ").concat(c)),e.next=11,E(t.id,{status:c});case 11:t.status=c;case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ne(e,t){return Fe.apply(this,arguments)}function Fe(){return(Fe=(0,c.A)(i().mark((function e(t,n){var r,a,o,c,s,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w();case 3:if(r=e.sent,a=r.find((function(e){return e.washId===t}))){e.next=9;break}return e.next=8,Swal.fire({icon:"error",title:"Wash job not found",text:"No data found in the system"});case 8:case 15:return e.abrupt("return");case 9:if(o=new Date(a.createdAt),(c=new Date(o)).setDate(o.getDate()+n),o.toISOString()!==c.toISOString()){e.next=16;break}return e.next=15,Swal.fire({icon:"info",title:"No date change"});case 16:return e.next=18,E(a.id,{createdAt:c.toISOString()});case 18:return e.next=20,w();case 20:return V(s=e.sent),$(s),u=c.toLocaleDateString("en-GB",{year:"numeric",month:"short",day:"numeric"}),e.next=26,Swal.fire({icon:"success",title:"Date shifted successfully",text:"→ ".concat(u),timer:2e3,showConfirmButton:!1});case 26:e.next=33;break;case 28:return e.prev=28,e.t0=e.catch(0),console.error("❌ shiftWashDate error:",e.t0),e.next=33,Swal.fire({icon:"error",title:"Error occurred",text:"Failed to shift date"});case 33:case"end":return e.stop()}}),e,null,[[0,28]])})))).apply(this,arguments)}function Te(){return He.apply(this,arguments)}function He(){return(He=(0,c.A)(i().mark((function e(){var t,n,a,o,c,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G("📤 Exporting wash job data..."),e.next=4,w();case 4:if((t=e.sent)&&0!==t.length){e.next=10;break}return e.next=8,Swal.fire({icon:"warning",title:"No data to export"});case 8:return q(),e.abrupt("return");case 10:return n=["Wash ID","Uniform Code","Color","Size","Employee ID","Employee Name","Status","Rewash Count","Created At"],a=t.map((function(e){var t;return[e.washId||"",e.uniformCode||"",e.color||"",e.size||"",e.empId||"",e.empName||"",e.status||"",null!==(t=e.rewashCount)&&void 0!==t?t:0,U(e.createdAt)]})),o=[n].concat((0,r.A)(a)).map((function(e){return e.map((function(e){return'"'.concat(String(e).replace(/"/g,'""'),'"')})).join(",")})).join("\n"),c=new Blob(["\ufeff"+o],{type:"text/csv;charset=utf-8;"}),(s=document.createElement("a")).href=URL.createObjectURL(c),s.download="wash-export-".concat(Date.now(),".csv"),document.body.appendChild(s),s.click(),s.remove(),e.next=22,Swal.fire({icon:"success",title:"CSV exported successfully",timer:2e3,showConfirmButton:!1});case 22:e.next=29;break;case 24:return e.prev=24,e.t0=e.catch(0),console.error("❌ exportWashToCSV error:",e.t0),e.next=29,Swal.fire({icon:"error",title:"Error occurred",text:"Failed to export data"});case 29:return e.prev=29,q(),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[0,24,29,32]])})))).apply(this,arguments)}function Me(){return Re.apply(this,arguments)}function Re(){return(Re=(0,c.A)(i().mark((function e(){var t,n,a,o,c,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,G("📤 Exporting wash history..."),e.next=4,D();case 4:if((t=e.sent)&&0!==t.length){e.next=10;break}return e.next=8,Swal.fire({icon:"warning",title:"No wash history to export"});case 8:return q(),e.abrupt("return");case 10:return n=["Wash ID","Uniform Code","Color","Size","Employee ID","Employee Name","Status","Rewash Count","Test Result","Test Date","Created At"],a=t.map((function(e){var t;return[e.washId||"",e.uniformCode||"",e.color||"",e.size||"",e.empId||"",e.empName||"",e.status||"",null!==(t=e.rewashCount)&&void 0!==t?t:0,e.testResult||"-",U(e.testDate),U(e.createdAt)]})),o=[n].concat((0,r.A)(a)).map((function(e){return e.map((function(e){return'"'.concat(String(e).replace(/"/g,'""'),'"')})).join(",")})).join("\n"),c=new Blob(["\ufeff"+o],{type:"text/csv;charset=utf-8;"}),(s=document.createElement("a")).href=URL.createObjectURL(c),s.download="wash-history-".concat(Date.now(),".csv"),document.body.appendChild(s),s.click(),s.remove(),e.next=22,Swal.fire({icon:"success",title:"Wash history exported successfully",timer:2e3,showConfirmButton:!1});case 22:e.next=29;break;case 24:return e.prev=24,e.t0=e.catch(0),console.error("❌ Export wash history error:",e.t0),e.next=29,Swal.fire({icon:"error",title:"Error occurred",text:"Failed to export wash history"});case 29:return e.prev=29,q(),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[0,24,29,32]])})))).apply(this,arguments)}},453:(e,t,n)=>{function r(e,t){var n;return function(){for(var r=this,a=arguments.length,o=new Array(a),c=0;c<a;c++)o[c]=arguments[c];clearTimeout(n),n=setTimeout((function(){return e.apply(r,o)}),t)}}function a(e){var t=document.getElementById(e);return t||console.warn("⚠️ Element #".concat(e," not found")),t}n.d(t,{s:()=>r,y:()=>a})},482:(e,t,n)=>{n.d(t,{db:()=>c});var r=n(223),a=n(594),o=(0,r.Wp)({apiKey:"AIzaSyAvJ4SgGaazPf6mY4G5-QfWcX2Yhkg-1X0",authDomain:"rd-wash-v2.firebaseapp.com",projectId:"rd-wash-v2",storageBucket:"rd-wash-v2.firebasestorage.app",messagingSenderId:"553662948172",appId:"1:553662948172:web:2423d7a81f2bbc9d53a5e9"}),c=(0,a.aU)(o)}}]);
//# sourceMappingURL=wash.js.map